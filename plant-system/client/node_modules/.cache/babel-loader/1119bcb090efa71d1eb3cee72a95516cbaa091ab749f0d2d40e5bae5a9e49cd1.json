{"ast":null,"code":"import _objectSpread from\"C:/Users/Admin/Downloads/SWP391/SWP391-Plant-Monitoring-System/plant-system/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useEffect,useState}from\"react\";import{Card,Row,Col,Form,Button,Badge}from\"react-bootstrap\";import thresholdsApi from\"../api/thresholdsApi\";import axiosClient from\"../api/axiosClient\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const defaultRules=[{id:\"R1\",expr:\"soil < 30 && temp > 28 && humid < 50\",action:\"PUMP_ON\",note:\"Nóng & khô -> bật bơm\"},{id:\"R2\",expr:\"soil > 55 || humid > 85\",action:\"PUMP_OFF\",note:\"Đã đủ ẩm -> tắt bơm\"}];export default function Thresholds(){const[zones,setZones]=useState([]);const[zoneId,setZoneId]=useState(\"\");const[rules,setRules]=useState(defaultRules);useEffect(()=>{axiosClient.get(\"/zones\").then(res=>{var _res$data;setZones(res.data||[]);if((_res$data=res.data)!==null&&_res$data!==void 0&&_res$data.length)setZoneId(res.data[0].id);});},[]);useEffect(()=>{if(!zoneId)return;thresholdsApi.get(zoneId).then(_ref=>{var _data$rules;let{data}=_ref;setRules(data!==null&&data!==void 0&&(_data$rules=data.rules)!==null&&_data$rules!==void 0&&_data$rules.length?data.rules:defaultRules);}).catch(()=>setRules(defaultRules));},[zoneId]);const updateRule=(idx,field,val)=>{const next=[...rules];next[idx]=_objectSpread(_objectSpread({},next[idx]),{},{[field]:val});setRules(next);};const addRule=()=>setRules([...rules,{id:\"R\".concat(rules.length+1),expr:\"\",action:\"PUMP_ON\",note:\"\"}]);const removeRule=idx=>setRules(rules.filter((_,i)=>i!==idx));const save=async()=>{await thresholdsApi.save(zoneId,{rules});alert(\"Đã lưu ngưỡng/rules cho zone!\");};return/*#__PURE__*/_jsxs(\"div\",{className:\"container py-3\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Configure Advanced Sensor Thresholds\"}),/*#__PURE__*/_jsxs(Row,{className:\"g-2 mb-3\",children:[/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Form.Select,{value:zoneId,onChange:e=>setZoneId(e.target.value),children:zones.map(z=>/*#__PURE__*/_jsx(\"option\",{value:z.id,children:z.name},z.id))})}),/*#__PURE__*/_jsxs(Col,{md:8,className:\"text-end\",children:[/*#__PURE__*/_jsx(Button,{onClick:addRule,className:\"me-2\",children:\"Th\\xEAm rule\"}),/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:save,children:\"L\\u01B0u\"})]})]}),rules.map((r,idx)=>/*#__PURE__*/_jsx(Card,{className:\"mb-2 p-3\",children:/*#__PURE__*/_jsxs(Row,{className:\"g-2 align-items-center\",children:[/*#__PURE__*/_jsx(Col,{md:1,children:/*#__PURE__*/_jsx(Badge,{bg:\"dark\",children:r.id})}),/*#__PURE__*/_jsxs(Col,{md:6,children:[/*#__PURE__*/_jsx(Form.Control,{value:r.expr,onChange:e=>updateRule(idx,\"expr\",e.target.value),placeholder:\"V\\xED d\\u1EE5: soil < 30 && temp > 28 && humid < 50\"}),/*#__PURE__*/_jsxs(Form.Text,{className:\"text-muted\",children:[\"Bi\\u1EBFn c\\xF3 s\\u1EB5n: \",/*#__PURE__*/_jsx(\"code\",{children:\"soil\"}),\", \",/*#__PURE__*/_jsx(\"code\",{children:\"temp\"}),\", \",/*#__PURE__*/_jsx(\"code\",{children:\"humid\"}),\", \",/*#__PURE__*/_jsx(\"code\",{children:\"light\"}),\", \",/*#__PURE__*/_jsx(\"code\",{children:\"air\"}),\".\"]})]}),/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsxs(Form.Select,{value:r.action,onChange:e=>updateRule(idx,\"action\",e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"PUMP_ON\",children:\"PUMP_ON\"}),/*#__PURE__*/_jsx(\"option\",{value:\"PUMP_OFF\",children:\"PUMP_OFF\"}),/*#__PURE__*/_jsx(\"option\",{value:\"ALERT_LOW_WATER\",children:\"ALERT_LOW_WATER\"})]})}),/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsx(Form.Control,{value:r.note,onChange:e=>updateRule(idx,\"note\",e.target.value),placeholder:\"Ghi ch\\xFA\"})}),/*#__PURE__*/_jsx(Col,{md:1,className:\"text-end\",children:/*#__PURE__*/_jsx(Button,{variant:\"outline-danger\",size:\"sm\",onClick:()=>removeRule(idx),children:\"X\\xF3a\"})})]})},r.id))]});}","map":{"version":3,"names":["useEffect","useState","Card","Row","Col","Form","Button","Badge","thresholdsApi","axiosClient","jsx","_jsx","jsxs","_jsxs","defaultRules","id","expr","action","note","Thresholds","zones","setZones","zoneId","setZoneId","rules","setRules","get","then","res","_res$data","data","length","_ref","_data$rules","catch","updateRule","idx","field","val","next","_objectSpread","addRule","concat","removeRule","filter","_","i","save","alert","className","children","md","Select","value","onChange","e","target","map","z","name","onClick","variant","r","bg","Control","placeholder","Text","size"],"sources":["C:/Users/Admin/Downloads/SWP391/SWP391-Plant-Monitoring-System/plant-system/client/src/pages/Thresholds.jsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { Card, Row, Col, Form, Button, Badge } from \"react-bootstrap\";\r\nimport thresholdsApi from \"../api/thresholdsApi\";\r\nimport axiosClient from \"../api/axiosClient\";\r\n\r\nconst defaultRules = [\r\n  { id: \"R1\", expr: \"soil < 30 && temp > 28 && humid < 50\", action: \"PUMP_ON\", note: \"Nóng & khô -> bật bơm\" },\r\n  { id: \"R2\", expr: \"soil > 55 || humid > 85\", action: \"PUMP_OFF\", note: \"Đã đủ ẩm -> tắt bơm\" },\r\n];\r\n\r\nexport default function Thresholds() {\r\n  const [zones, setZones] = useState([]);\r\n  const [zoneId, setZoneId] = useState(\"\");\r\n  const [rules, setRules] = useState(defaultRules);\r\n\r\n  useEffect(() => {\r\n    axiosClient.get(\"/zones\").then(res=>{\r\n      setZones(res.data||[]);\r\n      if (res.data?.length) setZoneId(res.data[0].id);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!zoneId) return;\r\n    thresholdsApi.get(zoneId).then(({data})=>{\r\n      setRules(data?.rules?.length ? data.rules : defaultRules);\r\n    }).catch(()=>setRules(defaultRules));\r\n  }, [zoneId]);\r\n\r\n  const updateRule = (idx, field, val) => {\r\n    const next = [...rules];\r\n    next[idx] = { ...next[idx], [field]: val };\r\n    setRules(next);\r\n  };\r\n\r\n  const addRule = () => setRules([...rules, { id: `R${rules.length+1}`, expr: \"\", action: \"PUMP_ON\", note: \"\" }]);\r\n  const removeRule = (idx) => setRules(rules.filter((_,i)=>i!==idx));\r\n\r\n  const save = async () => {\r\n    await thresholdsApi.save(zoneId, { rules });\r\n    alert(\"Đã lưu ngưỡng/rules cho zone!\");\r\n  };\r\n\r\n  return (\r\n    <div className=\"container py-3\">\r\n      <h3>Configure Advanced Sensor Thresholds</h3>\r\n      <Row className=\"g-2 mb-3\">\r\n        <Col md={4}>\r\n          <Form.Select value={zoneId} onChange={(e)=>setZoneId(e.target.value)}>\r\n            {zones.map(z=><option key={z.id} value={z.id}>{z.name}</option>)}\r\n          </Form.Select>\r\n        </Col>\r\n        <Col md={8} className=\"text-end\">\r\n          <Button onClick={addRule} className=\"me-2\">Thêm rule</Button>\r\n          <Button variant=\"success\" onClick={save}>Lưu</Button>\r\n        </Col>\r\n      </Row>\r\n\r\n      {rules.map((r, idx)=>(\r\n        <Card key={r.id} className=\"mb-2 p-3\">\r\n          <Row className=\"g-2 align-items-center\">\r\n            <Col md={1}><Badge bg=\"dark\">{r.id}</Badge></Col>\r\n            <Col md={6}>\r\n              <Form.Control value={r.expr} onChange={e=>updateRule(idx, \"expr\", e.target.value)}\r\n                placeholder='Ví dụ: soil < 30 && temp > 28 && humid < 50' />\r\n              <Form.Text className=\"text-muted\">\r\n                Biến có sẵn: <code>soil</code>, <code>temp</code>, <code>humid</code>, <code>light</code>, <code>air</code>.\r\n              </Form.Text>\r\n            </Col>\r\n            <Col md={2}>\r\n              <Form.Select value={r.action} onChange={e=>updateRule(idx,\"action\",e.target.value)}>\r\n                <option value=\"PUMP_ON\">PUMP_ON</option>\r\n                <option value=\"PUMP_OFF\">PUMP_OFF</option>\r\n                <option value=\"ALERT_LOW_WATER\">ALERT_LOW_WATER</option>\r\n              </Form.Select>\r\n            </Col>\r\n            <Col md={2}>\r\n              <Form.Control value={r.note} onChange={e=>updateRule(idx,\"note\",e.target.value)} placeholder=\"Ghi chú\"/>\r\n            </Col>\r\n            <Col md={1} className=\"text-end\">\r\n              <Button variant=\"outline-danger\" size=\"sm\" onClick={()=>removeRule(idx)}>Xóa</Button>\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
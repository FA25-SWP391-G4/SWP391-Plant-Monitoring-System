{"ast":null,"code":"import{useEffect,useMemo,useState}from\"react\";import{Row,Col,Form,Button,Card}from\"react-bootstrap\";import dayjs from\"dayjs\";import{Line}from\"react-chartjs-2\";import{Chart as ChartJS,LineElement,PointElement,LinearScale,CategoryScale,Legend,Tooltip}from\"chart.js\";import*as XLSX from\"xlsx\";import jsPDF from\"jspdf\";import\"jspdf-autotable\";import reportsApi from\"../api/reportsApi\";import axiosClient from\"../api/axiosClient\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";ChartJS.register(LineElement,PointElement,LinearScale,CategoryScale,Legend,Tooltip);export default function Reports(){const[zones,setZones]=useState([]);const[zoneId,setZoneId]=useState(\"\");const[from,setFrom]=useState(dayjs().subtract(7,\"day\").format(\"YYYY-MM-DD\"));const[to,setTo]=useState(dayjs().format(\"YYYY-MM-DD\"));const[series,setSeries]=useState([]);// [{ts, soil, temp, humid, light}]\nconst[loading,setLoading]=useState(false);useEffect(()=>{axiosClient.get(\"/zones\").then(res=>{var _res$data;setZones(res.data||[]);if((_res$data=res.data)!==null&&_res$data!==void 0&&_res$data.length)setZoneId(res.data[0].id);});},[]);const load=async()=>{if(!zoneId)return;setLoading(true);const{data}=await reportsApi.timeseries(zoneId,from,to,[\"soil\",\"temp\",\"humid\",\"light\"].join(\",\"));setSeries(data||[]);setLoading(false);};useEffect(()=>{if(zoneId)load();/* eslint-disable */},[zoneId]);const chartData=useMemo(()=>{const labels=series.map(r=>dayjs(r.ts).format(\"MM/DD HH:mm\"));return{labels,datasets:[{label:\"Soil Moisture\",data:series.map(r=>r.soil),borderWidth:2,fill:false},{label:\"Temperature (°C)\",data:series.map(r=>r.temp),borderWidth:2,fill:false},{label:\"Humidity (%)\",data:series.map(r=>r.humid),borderWidth:2,fill:false},{label:\"Light (lux)\",data:series.map(r=>r.light),borderWidth:2,fill:false}]};},[series]);const exportExcel=()=>{const ws=XLSX.utils.json_to_sheet(series);const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,\"Report\");XLSX.writeFile(wb,\"report_zone_\".concat(zoneId,\"_\").concat(from,\"_\").concat(to,\".xlsx\"));};const exportPDF=()=>{const doc=new jsPDF();doc.text(\"Plant Monitoring Report - Zone \".concat(zoneId),14,16);const rows=series.map(r=>[r.ts,r.soil,r.temp,r.humid,r.light]);doc.autoTable({head:[[\"Timestamp\",\"Soil\",\"Temp\",\"Humid\",\"Light\"]],body:rows,startY:22});doc.save(\"report_zone_\".concat(zoneId,\"_\").concat(from,\"_\").concat(to,\".pdf\"));};return/*#__PURE__*/_jsxs(\"div\",{className:\"container py-3\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Detailed Plant Monitoring Report\"}),/*#__PURE__*/_jsx(Card,{className:\"p-3 mb-3\",children:/*#__PURE__*/_jsxs(Row,{className:\"g-2\",children:[/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsx(Form.Select,{value:zoneId,onChange:e=>setZoneId(e.target.value),children:zones.map(z=>/*#__PURE__*/_jsx(\"option\",{value:z.id,children:z.name},z.id))})}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsx(Form.Control,{type:\"date\",value:from,onChange:e=>setFrom(e.target.value)})}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsx(Form.Control,{type:\"date\",value:to,onChange:e=>setTo(e.target.value)})}),/*#__PURE__*/_jsxs(Col,{md:3,className:\"d-flex gap-2\",children:[/*#__PURE__*/_jsx(Button,{onClick:load,disabled:loading,children:\"Load\"}),/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",onClick:exportExcel,disabled:!series.length,children:\"Excel\"}),/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",onClick:exportPDF,disabled:!series.length,children:\"PDF\"})]})]})}),/*#__PURE__*/_jsx(Card,{className:\"p-3\",children:/*#__PURE__*/_jsx(Line,{data:chartData,options:{responsive:true,maintainAspectRatio:false},height:420})})]});}","map":{"version":3,"names":["useEffect","useMemo","useState","Row","Col","Form","Button","Card","dayjs","Line","Chart","ChartJS","LineElement","PointElement","LinearScale","CategoryScale","Legend","Tooltip","XLSX","jsPDF","reportsApi","axiosClient","jsx","_jsx","jsxs","_jsxs","register","Reports","zones","setZones","zoneId","setZoneId","from","setFrom","subtract","format","to","setTo","series","setSeries","loading","setLoading","get","then","res","_res$data","data","length","id","load","timeseries","join","chartData","labels","map","r","ts","datasets","label","soil","borderWidth","fill","temp","humid","light","exportExcel","ws","utils","json_to_sheet","wb","book_new","book_append_sheet","writeFile","concat","exportPDF","doc","text","rows","autoTable","head","body","startY","save","className","children","md","Select","value","onChange","e","target","z","name","Control","type","onClick","disabled","variant","options","responsive","maintainAspectRatio","height"],"sources":["C:/Users/Admin/Downloads/SWP391/SWP391-Plant-Monitoring-System/plant-system/client/src/pages/Reports.jsx"],"sourcesContent":["import { useEffect, useMemo, useState } from \"react\";\r\nimport { Row, Col, Form, Button, Card } from \"react-bootstrap\";\r\nimport dayjs from \"dayjs\";\r\nimport { Line } from \"react-chartjs-2\";\r\nimport { Chart as ChartJS, LineElement, PointElement, LinearScale, CategoryScale, Legend, Tooltip } from \"chart.js\";\r\nimport * as XLSX from \"xlsx\";\r\nimport jsPDF from \"jspdf\";\r\nimport \"jspdf-autotable\";\r\nimport reportsApi from \"../api/reportsApi\";\r\nimport axiosClient from \"../api/axiosClient\";\r\n\r\nChartJS.register(LineElement, PointElement, LinearScale, CategoryScale, Legend, Tooltip);\r\n\r\nexport default function Reports() {\r\n  const [zones, setZones] = useState([]);\r\n  const [zoneId, setZoneId] = useState(\"\");\r\n  const [from, setFrom] = useState(dayjs().subtract(7, \"day\").format(\"YYYY-MM-DD\"));\r\n  const [to, setTo] = useState(dayjs().format(\"YYYY-MM-DD\"));\r\n  const [series, setSeries] = useState([]); // [{ts, soil, temp, humid, light}]\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    axiosClient.get(\"/zones\").then(res=>{\r\n      setZones(res.data||[]);\r\n      if (res.data?.length) setZoneId(res.data[0].id);\r\n    });\r\n  }, []);\r\n\r\n  const load = async () => {\r\n    if (!zoneId) return;\r\n    setLoading(true);\r\n    const { data } = await reportsApi.timeseries(zoneId, from, to, [\"soil\",\"temp\",\"humid\",\"light\"].join(\",\"));\r\n    setSeries(data || []);\r\n    setLoading(false);\r\n  };\r\n\r\n  useEffect(()=>{ if(zoneId) load(); /* eslint-disable */}, [zoneId]);\r\n\r\n  const chartData = useMemo(()=>{\r\n    const labels = series.map(r=>dayjs(r.ts).format(\"MM/DD HH:mm\"));\r\n    return {\r\n      labels,\r\n      datasets: [\r\n        { label: \"Soil Moisture\", data: series.map(r=>r.soil), borderWidth: 2, fill: false },\r\n        { label: \"Temperature (°C)\", data: series.map(r=>r.temp), borderWidth: 2, fill: false },\r\n        { label: \"Humidity (%)\", data: series.map(r=>r.humid), borderWidth: 2, fill: false },\r\n        { label: \"Light (lux)\", data: series.map(r=>r.light), borderWidth: 2, fill: false },\r\n      ],\r\n    };\r\n  }, [series]);\r\n\r\n  const exportExcel = () => {\r\n    const ws = XLSX.utils.json_to_sheet(series);\r\n    const wb = XLSX.utils.book_new();\r\n    XLSX.utils.book_append_sheet(wb, ws, \"Report\");\r\n    XLSX.writeFile(wb, `report_zone_${zoneId}_${from}_${to}.xlsx`);\r\n  };\r\n\r\n  const exportPDF = () => {\r\n    const doc = new jsPDF();\r\n    doc.text(`Plant Monitoring Report - Zone ${zoneId}`, 14, 16);\r\n    const rows = series.map(r=>[r.ts, r.soil, r.temp, r.humid, r.light]);\r\n    doc.autoTable({ head: [[\"Timestamp\",\"Soil\",\"Temp\",\"Humid\",\"Light\"]], body: rows, startY: 22 });\r\n    doc.save(`report_zone_${zoneId}_${from}_${to}.pdf`);\r\n  };\r\n\r\n  return (\r\n    <div className=\"container py-3\">\r\n      <h3>Detailed Plant Monitoring Report</h3>\r\n      <Card className=\"p-3 mb-3\">\r\n        <Row className=\"g-2\">\r\n          <Col md={3}>\r\n            <Form.Select value={zoneId} onChange={(e)=>setZoneId(e.target.value)}>\r\n              {zones.map(z=><option key={z.id} value={z.id}>{z.name}</option>)}\r\n            </Form.Select>\r\n          </Col>\r\n          <Col md={3}><Form.Control type=\"date\" value={from} onChange={e=>setFrom(e.target.value)} /></Col>\r\n          <Col md={3}><Form.Control type=\"date\" value={to} onChange={e=>setTo(e.target.value)} /></Col>\r\n          <Col md={3} className=\"d-flex gap-2\">\r\n            <Button onClick={load} disabled={loading}>Load</Button>\r\n            <Button variant=\"outline-secondary\" onClick={exportExcel} disabled={!series.length}>Excel</Button>\r\n            <Button variant=\"outline-secondary\" onClick={exportPDF} disabled={!series.length}>PDF</Button>\r\n          </Col>\r\n        </Row>\r\n      </Card>\r\n\r\n      <Card className=\"p-3\">\r\n        <Line data={chartData} options={{ responsive: true, maintainAspectRatio: false }} height={420}/>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
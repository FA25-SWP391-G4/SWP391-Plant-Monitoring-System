{"ast":null,"code":"import _objectSpread from\"C:/Users/Admin/Downloads/SWP391/SWP391-Plant-Monitoring-System/plant-system/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useEffect,useState}from\"react\";import{Row,Col,Form,Button,Table,Card}from\"react-bootstrap\";import dayjs from\"dayjs\";import*as XLSX from\"xlsx\";import jsPDF from\"jspdf\";import\"jspdf-autotable\";import reportsApi from\"../api/reportsApi\";import axiosClient from\"../api/axiosClient\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function SearchReports(){const[zones,setZones]=useState([]);const[query,setQuery]=useState({zoneId:\"\",from:dayjs().subtract(3,\"day\").format(\"YYYY-MM-DD\"),to:dayjs().format(\"YYYY-MM-DD\"),keyword:\"\"});const[rows,setRows]=useState([]);useEffect(()=>{axiosClient.get(\"/zones\").then(res=>{const zs=res.data||[];setZones(zs);if(zs.length)setQuery(q=>_objectSpread(_objectSpread({},q),{},{zoneId:zs[0].id}));});},[]);const search=async()=>{const{data}=await reportsApi.search(query);setRows(data||[]);};const exportExcel=()=>{const ws=XLSX.utils.json_to_sheet(rows);const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,\"Search\");XLSX.writeFile(wb,\"search_\".concat(query.zoneId,\"_\").concat(query.from,\"_\").concat(query.to,\".xlsx\"));};const exportPDF=()=>{const doc=new jsPDF();doc.text(\"Reports Search - Zone \".concat(query.zoneId),14,16);const body=rows.map(r=>[r.ts,r.metric,r.value,r.zoneName]);doc.autoTable({head:[[\"Timestamp\",\"Metric\",\"Value\",\"Zone\"]],body,startY:22});doc.save(\"search_\".concat(query.zoneId,\"_\").concat(query.from,\"_\").concat(query.to,\".pdf\"));};return/*#__PURE__*/_jsxs(\"div\",{className:\"container py-3\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Search Plant Monitoring Reports\"}),/*#__PURE__*/_jsx(Card,{className:\"p-3 mb-3\",children:/*#__PURE__*/_jsxs(Row,{className:\"g-2\",children:[/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsx(Form.Select,{value:query.zoneId,onChange:e=>setQuery(_objectSpread(_objectSpread({},query),{},{zoneId:e.target.value})),children:zones.map(z=>/*#__PURE__*/_jsx(\"option\",{value:z.id,children:z.name},z.id))})}),/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsx(Form.Control,{type:\"date\",value:query.from,onChange:e=>setQuery(_objectSpread(_objectSpread({},query),{},{from:e.target.value}))})}),/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsx(Form.Control,{type:\"date\",value:query.to,onChange:e=>setQuery(_objectSpread(_objectSpread({},query),{},{to:e.target.value}))})}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsx(Form.Control,{placeholder:\"keyword (vd: low water)\",value:query.keyword,onChange:e=>setQuery(_objectSpread(_objectSpread({},query),{},{keyword:e.target.value}))})}),/*#__PURE__*/_jsxs(Col,{md:2,className:\"d-flex gap-2\",children:[/*#__PURE__*/_jsx(Button,{onClick:search,children:\"Search\"}),/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",onClick:exportExcel,disabled:!rows.length,children:\"Excel\"}),/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",onClick:exportPDF,disabled:!rows.length,children:\"PDF\"})]})]})}),/*#__PURE__*/_jsxs(Table,{bordered:true,hover:true,size:\"sm\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Timestamp\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Metric\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Value\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Zone\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{children:[rows.map((r,i)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:r.ts}),/*#__PURE__*/_jsx(\"td\",{children:r.metric}),/*#__PURE__*/_jsx(\"td\",{children:r.value}),/*#__PURE__*/_jsx(\"td\",{children:r.zoneName})]},i)),!rows.length&&/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:4,className:\"text-muted\",children:\"Kh\\xF4ng c\\xF3 d\\u1EEF li\\u1EC7u\"})})]})]})]});}","map":{"version":3,"names":["useEffect","useState","Row","Col","Form","Button","Table","Card","dayjs","XLSX","jsPDF","reportsApi","axiosClient","jsx","_jsx","jsxs","_jsxs","SearchReports","zones","setZones","query","setQuery","zoneId","from","subtract","format","to","keyword","rows","setRows","get","then","res","zs","data","length","q","_objectSpread","id","search","exportExcel","ws","utils","json_to_sheet","wb","book_new","book_append_sheet","writeFile","concat","exportPDF","doc","text","body","map","r","ts","metric","value","zoneName","autoTable","head","startY","save","className","children","md","Select","onChange","e","target","z","name","Control","type","placeholder","onClick","variant","disabled","bordered","hover","size","i","colSpan"],"sources":["C:/Users/Admin/Downloads/SWP391/SWP391-Plant-Monitoring-System/plant-system/client/src/pages/SearchReports.jsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { Row, Col, Form, Button, Table, Card } from \"react-bootstrap\";\r\nimport dayjs from \"dayjs\";\r\nimport * as XLSX from \"xlsx\";\r\nimport jsPDF from \"jspdf\";\r\nimport \"jspdf-autotable\";\r\nimport reportsApi from \"../api/reportsApi\";\r\nimport axiosClient from \"../api/axiosClient\";\r\n\r\nexport default function SearchReports() {\r\n  const [zones, setZones] = useState([]);\r\n  const [query, setQuery] = useState({\r\n    zoneId: \"\",\r\n    from: dayjs().subtract(3, \"day\").format(\"YYYY-MM-DD\"),\r\n    to: dayjs().format(\"YYYY-MM-DD\"),\r\n    keyword: \"\",\r\n  });\r\n  const [rows, setRows] = useState([]);\r\n\r\n  useEffect(() => {\r\n    axiosClient.get(\"/zones\").then(res=>{\r\n      const zs = res.data||[];\r\n      setZones(zs);\r\n      if (zs.length) setQuery(q=>({...q, zoneId: zs[0].id}));\r\n    });\r\n  }, []);\r\n\r\n  const search = async () => {\r\n    const { data } = await reportsApi.search(query);\r\n    setRows(data || []);\r\n  };\r\n\r\n  const exportExcel = () => {\r\n    const ws = XLSX.utils.json_to_sheet(rows);\r\n    const wb = XLSX.utils.book_new();\r\n    XLSX.utils.book_append_sheet(wb, ws, \"Search\");\r\n    XLSX.writeFile(wb, `search_${query.zoneId}_${query.from}_${query.to}.xlsx`);\r\n  };\r\n\r\n  const exportPDF = () => {\r\n    const doc = new jsPDF();\r\n    doc.text(`Reports Search - Zone ${query.zoneId}`, 14, 16);\r\n    const body = rows.map(r=>[r.ts, r.metric, r.value, r.zoneName]);\r\n    doc.autoTable({ head: [[\"Timestamp\",\"Metric\",\"Value\",\"Zone\"]], body, startY: 22 });\r\n    doc.save(`search_${query.zoneId}_${query.from}_${query.to}.pdf`);\r\n  };\r\n\r\n  return (\r\n    <div className=\"container py-3\">\r\n      <h3>Search Plant Monitoring Reports</h3>\r\n      <Card className=\"p-3 mb-3\">\r\n        <Row className=\"g-2\">\r\n          <Col md={3}>\r\n            <Form.Select value={query.zoneId} onChange={e=>setQuery({...query, zoneId:e.target.value})}>\r\n              {zones.map(z=><option key={z.id} value={z.id}>{z.name}</option>)}\r\n            </Form.Select>\r\n          </Col>\r\n          <Col md={2}><Form.Control type=\"date\" value={query.from} onChange={e=>setQuery({...query, from:e.target.value})}/></Col>\r\n          <Col md={2}><Form.Control type=\"date\" value={query.to} onChange={e=>setQuery({...query, to:e.target.value})}/></Col>\r\n          <Col md={3}><Form.Control placeholder=\"keyword (vd: low water)\" value={query.keyword} onChange={e=>setQuery({...query, keyword:e.target.value})}/></Col>\r\n          <Col md={2} className=\"d-flex gap-2\">\r\n            <Button onClick={search}>Search</Button>\r\n            <Button variant=\"outline-secondary\" onClick={exportExcel} disabled={!rows.length}>Excel</Button>\r\n            <Button variant=\"outline-secondary\" onClick={exportPDF} disabled={!rows.length}>PDF</Button>\r\n          </Col>\r\n        </Row>\r\n      </Card>\r\n\r\n      <Table bordered hover size=\"sm\">\r\n        <thead><tr><th>Timestamp</th><th>Metric</th><th>Value</th><th>Zone</th></tr></thead>\r\n        <tbody>\r\n          {rows.map((r,i)=>(\r\n            <tr key={i}>\r\n              <td>{r.ts}</td>\r\n              <td>{r.metric}</td>\r\n              <td>{r.value}</td>\r\n              <td>{r.zoneName}</td>\r\n            </tr>\r\n          ))}\r\n          {!rows.length && <tr><td colSpan={4} className=\"text-muted\">Không có dữ liệu</td></tr>}\r\n        </tbody>\r\n      </Table>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"uKAAA,OAASA,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAC3C,OAASC,GAAG,CAAEC,GAAG,CAAEC,IAAI,CAAEC,MAAM,CAAEC,KAAK,CAAEC,IAAI,KAAQ,iBAAiB,CACrE,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,MAAO,GAAK,CAAAC,IAAI,KAAM,MAAM,CAC5B,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,MAAO,iBAAiB,CACxB,MAAO,CAAAC,UAAU,KAAM,mBAAmB,CAC1C,MAAO,CAAAC,WAAW,KAAM,oBAAoB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAE7C,cAAe,SAAS,CAAAC,aAAaA,CAAA,CAAG,CACtC,KAAM,CAACC,KAAK,CAAEC,QAAQ,CAAC,CAAGlB,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACmB,KAAK,CAAEC,QAAQ,CAAC,CAAGpB,QAAQ,CAAC,CACjCqB,MAAM,CAAE,EAAE,CACVC,IAAI,CAAEf,KAAK,CAAC,CAAC,CAACgB,QAAQ,CAAC,CAAC,CAAE,KAAK,CAAC,CAACC,MAAM,CAAC,YAAY,CAAC,CACrDC,EAAE,CAAElB,KAAK,CAAC,CAAC,CAACiB,MAAM,CAAC,YAAY,CAAC,CAChCE,OAAO,CAAE,EACX,CAAC,CAAC,CACF,KAAM,CAACC,IAAI,CAAEC,OAAO,CAAC,CAAG5B,QAAQ,CAAC,EAAE,CAAC,CAEpCD,SAAS,CAAC,IAAM,CACdY,WAAW,CAACkB,GAAG,CAAC,QAAQ,CAAC,CAACC,IAAI,CAACC,GAAG,EAAE,CAClC,KAAM,CAAAC,EAAE,CAAGD,GAAG,CAACE,IAAI,EAAE,EAAE,CACvBf,QAAQ,CAACc,EAAE,CAAC,CACZ,GAAIA,EAAE,CAACE,MAAM,CAAEd,QAAQ,CAACe,CAAC,EAAAC,aAAA,CAAAA,aAAA,IAAOD,CAAC,MAAEd,MAAM,CAAEW,EAAE,CAAC,CAAC,CAAC,CAACK,EAAE,EAAE,CAAC,CACxD,CAAC,CAAC,CACJ,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAC,MAAM,CAAG,KAAAA,CAAA,GAAY,CACzB,KAAM,CAAEL,IAAK,CAAC,CAAG,KAAM,CAAAvB,UAAU,CAAC4B,MAAM,CAACnB,KAAK,CAAC,CAC/CS,OAAO,CAACK,IAAI,EAAI,EAAE,CAAC,CACrB,CAAC,CAED,KAAM,CAAAM,WAAW,CAAGA,CAAA,GAAM,CACxB,KAAM,CAAAC,EAAE,CAAGhC,IAAI,CAACiC,KAAK,CAACC,aAAa,CAACf,IAAI,CAAC,CACzC,KAAM,CAAAgB,EAAE,CAAGnC,IAAI,CAACiC,KAAK,CAACG,QAAQ,CAAC,CAAC,CAChCpC,IAAI,CAACiC,KAAK,CAACI,iBAAiB,CAACF,EAAE,CAAEH,EAAE,CAAE,QAAQ,CAAC,CAC9ChC,IAAI,CAACsC,SAAS,CAACH,EAAE,WAAAI,MAAA,CAAY5B,KAAK,CAACE,MAAM,MAAA0B,MAAA,CAAI5B,KAAK,CAACG,IAAI,MAAAyB,MAAA,CAAI5B,KAAK,CAACM,EAAE,SAAO,CAAC,CAC7E,CAAC,CAED,KAAM,CAAAuB,SAAS,CAAGA,CAAA,GAAM,CACtB,KAAM,CAAAC,GAAG,CAAG,GAAI,CAAAxC,KAAK,CAAC,CAAC,CACvBwC,GAAG,CAACC,IAAI,0BAAAH,MAAA,CAA0B5B,KAAK,CAACE,MAAM,EAAI,EAAE,CAAE,EAAE,CAAC,CACzD,KAAM,CAAA8B,IAAI,CAAGxB,IAAI,CAACyB,GAAG,CAACC,CAAC,EAAE,CAACA,CAAC,CAACC,EAAE,CAAED,CAAC,CAACE,MAAM,CAAEF,CAAC,CAACG,KAAK,CAAEH,CAAC,CAACI,QAAQ,CAAC,CAAC,CAC/DR,GAAG,CAACS,SAAS,CAAC,CAAEC,IAAI,CAAE,CAAC,CAAC,WAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAER,IAAI,CAAES,MAAM,CAAE,EAAG,CAAC,CAAC,CAClFX,GAAG,CAACY,IAAI,WAAAd,MAAA,CAAW5B,KAAK,CAACE,MAAM,MAAA0B,MAAA,CAAI5B,KAAK,CAACG,IAAI,MAAAyB,MAAA,CAAI5B,KAAK,CAACM,EAAE,QAAM,CAAC,CAClE,CAAC,CAED,mBACEV,KAAA,QAAK+C,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7BlD,IAAA,OAAAkD,QAAA,CAAI,iCAA+B,CAAI,CAAC,cACxClD,IAAA,CAACP,IAAI,EAACwD,SAAS,CAAC,UAAU,CAAAC,QAAA,cACxBhD,KAAA,CAACd,GAAG,EAAC6D,SAAS,CAAC,KAAK,CAAAC,QAAA,eAClBlD,IAAA,CAACX,GAAG,EAAC8D,EAAE,CAAE,CAAE,CAAAD,QAAA,cACTlD,IAAA,CAACV,IAAI,CAAC8D,MAAM,EAACT,KAAK,CAAErC,KAAK,CAACE,MAAO,CAAC6C,QAAQ,CAAEC,CAAC,EAAE/C,QAAQ,CAAAgB,aAAA,CAAAA,aAAA,IAAKjB,KAAK,MAAEE,MAAM,CAAC8C,CAAC,CAACC,MAAM,CAACZ,KAAK,EAAC,CAAE,CAAAO,QAAA,CACxF9C,KAAK,CAACmC,GAAG,CAACiB,CAAC,eAAExD,IAAA,WAAmB2C,KAAK,CAAEa,CAAC,CAAChC,EAAG,CAAA0B,QAAA,CAAEM,CAAC,CAACC,IAAI,EAA1BD,CAAC,CAAChC,EAAiC,CAAC,CAAC,CACrD,CAAC,CACX,CAAC,cACNxB,IAAA,CAACX,GAAG,EAAC8D,EAAE,CAAE,CAAE,CAAAD,QAAA,cAAClD,IAAA,CAACV,IAAI,CAACoE,OAAO,EAACC,IAAI,CAAC,MAAM,CAAChB,KAAK,CAAErC,KAAK,CAACG,IAAK,CAAC4C,QAAQ,CAAEC,CAAC,EAAE/C,QAAQ,CAAAgB,aAAA,CAAAA,aAAA,IAAKjB,KAAK,MAAEG,IAAI,CAAC6C,CAAC,CAACC,MAAM,CAACZ,KAAK,EAAC,CAAE,CAAC,CAAC,CAAK,CAAC,cACxH3C,IAAA,CAACX,GAAG,EAAC8D,EAAE,CAAE,CAAE,CAAAD,QAAA,cAAClD,IAAA,CAACV,IAAI,CAACoE,OAAO,EAACC,IAAI,CAAC,MAAM,CAAChB,KAAK,CAAErC,KAAK,CAACM,EAAG,CAACyC,QAAQ,CAAEC,CAAC,EAAE/C,QAAQ,CAAAgB,aAAA,CAAAA,aAAA,IAAKjB,KAAK,MAAEM,EAAE,CAAC0C,CAAC,CAACC,MAAM,CAACZ,KAAK,EAAC,CAAE,CAAC,CAAC,CAAK,CAAC,cACpH3C,IAAA,CAACX,GAAG,EAAC8D,EAAE,CAAE,CAAE,CAAAD,QAAA,cAAClD,IAAA,CAACV,IAAI,CAACoE,OAAO,EAACE,WAAW,CAAC,yBAAyB,CAACjB,KAAK,CAAErC,KAAK,CAACO,OAAQ,CAACwC,QAAQ,CAAEC,CAAC,EAAE/C,QAAQ,CAAAgB,aAAA,CAAAA,aAAA,IAAKjB,KAAK,MAAEO,OAAO,CAACyC,CAAC,CAACC,MAAM,CAACZ,KAAK,EAAC,CAAE,CAAC,CAAC,CAAK,CAAC,cACxJzC,KAAA,CAACb,GAAG,EAAC8D,EAAE,CAAE,CAAE,CAACF,SAAS,CAAC,cAAc,CAAAC,QAAA,eAClClD,IAAA,CAACT,MAAM,EAACsE,OAAO,CAAEpC,MAAO,CAAAyB,QAAA,CAAC,QAAM,CAAQ,CAAC,cACxClD,IAAA,CAACT,MAAM,EAACuE,OAAO,CAAC,mBAAmB,CAACD,OAAO,CAAEnC,WAAY,CAACqC,QAAQ,CAAE,CAACjD,IAAI,CAACO,MAAO,CAAA6B,QAAA,CAAC,OAAK,CAAQ,CAAC,cAChGlD,IAAA,CAACT,MAAM,EAACuE,OAAO,CAAC,mBAAmB,CAACD,OAAO,CAAE1B,SAAU,CAAC4B,QAAQ,CAAE,CAACjD,IAAI,CAACO,MAAO,CAAA6B,QAAA,CAAC,KAAG,CAAQ,CAAC,EACzF,CAAC,EACH,CAAC,CACF,CAAC,cAEPhD,KAAA,CAACV,KAAK,EAACwE,QAAQ,MAACC,KAAK,MAACC,IAAI,CAAC,IAAI,CAAAhB,QAAA,eAC7BlD,IAAA,UAAAkD,QAAA,cAAOhD,KAAA,OAAAgD,QAAA,eAAIlD,IAAA,OAAAkD,QAAA,CAAI,WAAS,CAAI,CAAC,cAAAlD,IAAA,OAAAkD,QAAA,CAAI,QAAM,CAAI,CAAC,cAAAlD,IAAA,OAAAkD,QAAA,CAAI,OAAK,CAAI,CAAC,cAAAlD,IAAA,OAAAkD,QAAA,CAAI,MAAI,CAAI,CAAC,EAAI,CAAC,CAAO,CAAC,cACpFhD,KAAA,UAAAgD,QAAA,EACGpC,IAAI,CAACyB,GAAG,CAAC,CAACC,CAAC,CAAC2B,CAAC,gBACZjE,KAAA,OAAAgD,QAAA,eACElD,IAAA,OAAAkD,QAAA,CAAKV,CAAC,CAACC,EAAE,CAAK,CAAC,cACfzC,IAAA,OAAAkD,QAAA,CAAKV,CAAC,CAACE,MAAM,CAAK,CAAC,cACnB1C,IAAA,OAAAkD,QAAA,CAAKV,CAAC,CAACG,KAAK,CAAK,CAAC,cAClB3C,IAAA,OAAAkD,QAAA,CAAKV,CAAC,CAACI,QAAQ,CAAK,CAAC,GAJduB,CAKL,CACL,CAAC,CACD,CAACrD,IAAI,CAACO,MAAM,eAAIrB,IAAA,OAAAkD,QAAA,cAAIlD,IAAA,OAAIoE,OAAO,CAAE,CAAE,CAACnB,SAAS,CAAC,YAAY,CAAAC,QAAA,CAAC,kCAAgB,CAAI,CAAC,CAAI,CAAC,EACjF,CAAC,EACH,CAAC,EACL,CAAC,CAEV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"// src/pages/Login.jsx\nimport{useState}from\"react\";import{useNavigate,Link}from\"react-router-dom\";import authApi from\"../api/authApi\";import{useAuth}from\"../auth/AuthContext\";import{useGoogleLogin}from'@react-oauth/google';import axios from\"axios\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Login(){const nav=useNavigate();const{login}=useAuth();const[email,setEmail]=useState(\"\");const[password,setPassword]=useState(\"\");const[err,setErr]=useState(\"\");const onSubmit=async e=>{e.preventDefault();setErr(\"\");try{const{data}=await authApi.login(email,password);// Expect backend returns { token, user }\nlogin(data.token,data.user);nav(\"/\");}catch(e){var _e$response,_e$response$data;console.error(\"❌ Login error:\",e);// log the raw error\nconsole.error(\"❌ Backend response:\",e===null||e===void 0?void 0:e.response);// log response object\nsetErr((e===null||e===void 0?void 0:(_e$response=e.response)===null||_e$response===void 0?void 0:(_e$response$data=_e$response.data)===null||_e$response$data===void 0?void 0:_e$response$data.message)||e.message||\"Login failed\");}};const loginWithGoogle=useGoogleLogin({onSuccess:async response=>{try{// response contains an access token\nconst token=response.credential||response.access_token;const{data}=await authApi.loginWithGoogle(token);// Save JWT to context/localStorage\nlogin(data.token,{role:data.role});nav(\"/\");// redirect to home\n}catch(err){console.error(\"Google login error:\",err);}},onError:()=>{console.error(\"Google login failed\");}});return/*#__PURE__*/_jsxs(\"div\",{className:\"container py-5\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Login\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmit,className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Email\",value:email,onChange:e=>setEmail(e.target.value),className:\"form-control mb-2\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary\",onClick:()=>{const fake={token:\"dev\",user:{id:1,name:\"Dev\",role:\"Premium\"}};localStorage.setItem(\"token\",fake.token);localStorage.setItem(\"user\",JSON.stringify(fake.user));window.location.href=\"/\";},children:\"Dev bypass\"}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Password\",type:\"password\",value:password,onChange:e=>setPassword(e.target.value),className:\"form-control mb-2\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary\",children:\"Login\"})]}),err&&/*#__PURE__*/_jsx(\"p\",{className:\"text-danger\",children:err}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Don\\u2019t have an account yet?\",\" \",/*#__PURE__*/_jsx(Link,{to:\"/register\",children:\"Register here\"})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"button\",{onClick:loginWithGoogle,className:\"btn btn-outline-danger\",children:\"Continue with Google\"})]});}","map":{"version":3,"names":["useState","useNavigate","Link","authApi","useAuth","useGoogleLogin","axios","jsx","_jsx","jsxs","_jsxs","Login","nav","login","email","setEmail","password","setPassword","err","setErr","onSubmit","e","preventDefault","data","token","user","_e$response","_e$response$data","console","error","response","message","loginWithGoogle","onSuccess","credential","access_token","role","onError","className","children","placeholder","value","onChange","target","type","onClick","fake","id","name","localStorage","setItem","JSON","stringify","window","location","href","to"],"sources":["C:/Users/Admin/Downloads/SWP391/SWP391-Plant-Monitoring-System/plant-system/client/src/pages/Login.jsx"],"sourcesContent":["// src/pages/Login.jsx\r\nimport { useState } from \"react\";\r\nimport { useNavigate, Link } from \"react-router-dom\";\r\nimport authApi from \"../api/authApi\";\r\nimport { useAuth } from \"../auth/AuthContext\";\r\nimport { useGoogleLogin } from '@react-oauth/google';\r\nimport axios from \"axios\";\r\n\r\n\r\nexport default function Login() {\r\n  const nav = useNavigate();\r\n  const { login } = useAuth();\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [err, setErr] = useState(\"\");\r\n\r\n  const onSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setErr(\"\");\r\n    try {\r\n      const { data } = await authApi.login(email, password);\r\n      // Expect backend returns { token, user }\r\n      login(data.token, data.user);\r\n      nav(\"/\");\r\n    } catch (e) {\r\n      console.error(\"❌ Login error:\", e);                  // log the raw error\r\n      console.error(\"❌ Backend response:\", e?.response);   // log response object\r\n      setErr(e?.response?.data?.message || e.message || \"Login failed\");\r\n    }\r\n  };\r\n\r\n  const loginWithGoogle = useGoogleLogin({\r\n    onSuccess: async (response) => {\r\n      try {\r\n        // response contains an access token\r\n        const token = response.credential || response.access_token; \r\n        const { data } = await authApi.loginWithGoogle(token);\r\n        // Save JWT to context/localStorage\r\n        login(data.token, { role: data.role }); \r\n        nav(\"/\"); // redirect to home\r\n      } catch (err) {\r\n        console.error(\"Google login error:\", err);\r\n      }\r\n    },\r\n    onError: () => {\r\n      console.error(\"Google login failed\");\r\n    },\r\n  });\r\n\r\n  return (\r\n    <div className=\"container py-5\">\r\n      <h2>Login</h2>\r\n      <form onSubmit={onSubmit} className=\"mb-3\">\r\n        <input\r\n          placeholder=\"Email\"\r\n          value={email}\r\n          onChange={(e) => setEmail(e.target.value)}\r\n          className=\"form-control mb-2\"\r\n        />\r\n        <button\r\n  type=\"button\"\r\n  className=\"btn btn-secondary\"\r\n  onClick={()=>{\r\n    const fake = { token:\"dev\", user:{id:1,name:\"Dev\",role:\"Premium\"} };\r\n    localStorage.setItem(\"token\", fake.token);\r\n    localStorage.setItem(\"user\", JSON.stringify(fake.user));\r\n    window.location.href=\"/\";\r\n  }}\r\n>\r\n  Dev bypass\r\n</button>\r\n\r\n        <input\r\n          placeholder=\"Password\"\r\n          type=\"password\"\r\n          value={password}\r\n          onChange={(e) => setPassword(e.target.value)}\r\n          className=\"form-control mb-2\"\r\n        />\r\n        <button type=\"submit\" className=\"btn btn-primary\">Login</button>\r\n      </form>\r\n      {err && <p className=\"text-danger\">{err}</p>}\r\n\r\n      <p>\r\n        Don’t have an account yet?{\" \"}\r\n        <Link to=\"/register\">Register here</Link>\r\n      </p>\r\n\r\n      <hr />\r\n      <button onClick={loginWithGoogle} className=\"btn btn-outline-danger\">\r\n        Continue with Google\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}